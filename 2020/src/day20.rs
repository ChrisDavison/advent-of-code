use crate::prelude::*;

const MONSTER: &str = "..................#.#....##....##....###.#..#..#..#..#..#...";

pub fn day20() -> Result<()> {
    let tiles: Vec<Tile> = parse_each(INPUT.split("\n\n"));
    let aligned = align_tiles(&tiles);

    println!("2020 20.1 -> {}", part1(&aligned));
    println!("2020 20.2 -> {}", part2(&aligned)?);

    Ok(())
}

fn part1(tile_grid: &[Vec<Tile>]) -> String {
    let n = tile_grid.len() - 1;
    let corner_product = [(0, 0), (0, n), (n, 0), (n, n)]
        .iter()
        .map(|&(x, y)| tile_grid[x][y].id)
        .product::<usize>();

    format!("{}", corner_product)
}

fn part2(tile_grid: &[Vec<Tile>]) -> Result<String> {
    let n = tile_grid[0].len();

    let img_height = tile_grid[0][0].size - 2;
    let mut img: Vec<String> = (0..n * img_height).map(|_| String::new()).collect();
    for (i, row) in tile_grid.iter().enumerate() {
        for tile in row {
            for (img_row, pixels) in tile.grid.iter().skip(1).take(img_height).enumerate() {
                let actual_col = img_row + img_height * i;
                img[actual_col].push_str(&pixels.iter().skip(1).take(img_height).join(""));
            }
        }
    }

    let img_str = format!("Tile 0:\n{}", img.join("\n"));

    let t: Tile = img_str.parse()?;

    let mut n_monster = 0;
    for orientation in t.orientations() {
        n_monster = count_monsters(&orientation);
        if n_monster > 0 {
            break;
        }
    }

    let n_hash_in_monster = n_monster * MONSTER.chars().filter(|c| *c == '#').count();
    let n_hash = format!("{}", t).replace(".", "").replace("\n", "").len();

    Ok(format!("{}", n_hash - n_hash_in_monster))
}

fn align_tiles(tiles: &[Tile]) -> Vec<Vec<Tile>> {
    let mut map: HashMap<usize, (isize, isize)> = HashMap::new();
    let mut tiles = tiles.to_vec();
    map.insert(tiles[0].id, (0, 0));

    loop {
        if map.len() == tiles.len() {
            break;
        }

        for i in 0..tiles.len() {
            let tile_a = tiles[i].clone();
            if !map.contains_key(&tile_a.id) {
                continue;
            }
            for (j, tile_b) in tiles.iter().enumerate() {
                if i == j {
                    continue;
                }
                if map.contains_key(&tile_b.id) {
                    continue;
                }

                let tilematch = tile_a.can_match(&tile_b);
                if tilematch.is_none() {
                    continue;
                }
                let (t1, t2, direction) = tilematch.unwrap();
                let (dx, dy) = match direction {
                    Direction::North => (0, -1),
                    Direction::South => (0, 1),
                    Direction::East => (1, 0),
                    Direction::West => (-1, 0),
                };
                let mut new_pos = map[&t1.id];
                new_pos.0 += dx;
                new_pos.1 += dy;
                map.insert(t2.id, new_pos);
                tiles[j] = t2;
                break;
            }
        }
    }

    let n = (tiles.len() as f64).sqrt() as usize;
    let mut canvas: Vec<Vec<Tile>> = vec![vec![Default::default(); n]; n];

    let left = map.values().map(|(x, _y)| x).min().unwrap();
    let top = map.values().map(|(_x, y)| y).min().unwrap();

    // normalise all grid positions
    for (tile_id, position) in &map {
        let x = position.0 - left;
        let y = position.1 - top;
        canvas[y as usize][x as usize] = tiles.iter().find(|t| t.id == *tile_id).unwrap().clone();
    }
    canvas
}

fn count_monsters(t: &Tile) -> usize {
    let monster_idx: Vec<usize> = MONSTER
        .char_indices()
        .filter(|(_i, c)| *c == '#')
        .map(|(i, _)| i)
        .collect();

    let mut matches = 0;
    for stride in t.strides(20, 3) {
        let s = stride.iter().flatten().map(|x| *x).collect::<Vec<char>>();
        if monster_idx.iter().all(|i| s[*i] == '#') {
            matches += 1;
        }
    }
    matches
}

#[derive(Debug, Clone, PartialEq, Hash, Eq, Default)]
struct Tile {
    id: usize,
    size: usize,
    grid: Vec<Vec<char>>,
}

impl std::str::FromStr for Tile {
    type Err = anyhow::Error;

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        let id = s
            .lines()
            .next()
            .map(|s| s.trim_end_matches(':'))
            .map(|s| s.split(' ').nth(1).expect("No tile ID"))
            .expect("No tile ID")
            .parse::<usize>()?;

        let grid: Vec<&str> = s.lines().skip(1).collect();
        let grid: Vec<Vec<char>> = grid.iter().map(|c| c.chars().collect()).collect();

        let size: usize = grid[0].len();
        Ok(Tile { id, size, grid })
    }
}

struct TileOrientations {
    t: Tile,
    iteration: usize,
}

impl std::iter::Iterator for TileOrientations {
    type Item = Tile;
    fn next(&mut self) -> Option<Self::Item> {
        if self.iteration > 8 {
            return None;
        }
        let mut t = if self.iteration < 4 {
            self.t.clone()
        } else {
            let mut t = self.t.clone();
            t.flip_top_bottom();
            t
        };
        // Don't need to do EW, as EW is just NS flip with rotation
        t.rotate_n(self.iteration % 4);

        self.iteration += 1;
        Some(t)
    }
}

enum Direction {
    North,
    South,
    East,
    West,
}

impl Tile {
    fn rotate(&mut self) {
        let mut grid2 = self.grid.clone();

        for (i, row) in self.grid.iter().enumerate() {
            for (j, ch) in row.iter().enumerate() {
                grid2[j][self.size - i - 1] = *ch;
            }
        }
        self.grid = grid2;
    }

    fn rotate_n(&mut self, n: usize) {
        let n = n % 4;
        for _ in 0..n {
            self.rotate();
        }
    }

    fn flip_top_bottom(&mut self) {
        let mut grid2 = self.grid.clone();
        for (i, row) in self.grid.iter().enumerate() {
            grid2[self.size - i - 1] = row.clone();
        }
        self.grid = grid2;
    }

    fn orientations(&self) -> TileOrientations {
        TileOrientations {
            t: self.clone(),
            iteration: 0,
        }
    }

    fn can_match(&self, other: &Tile) -> Option<(Tile, Tile, Direction)> {
        // for orientation in self.orientations() {
        for orientation_2 in other.orientations() {
            if let Some(dir) = Tile::matching_edge(&self, &orientation_2) {
                return Some((self.clone(), orientation_2, dir));
            }
        }
        // }
        None
    }

    fn edges(&self) -> (Vec<char>, Vec<char>, Vec<char>, Vec<char>) {
        let top = self.grid[0].clone();
        let bot = self.grid[self.size - 1].clone();
        let left = self.grid.iter().map(|row| row[0]).collect();
        let right = self.grid.iter().map(|row| row[self.size - 1]).collect();
        (top, right, bot, left)
    }

    fn matching_edge(a: &Tile, b: &Tile) -> Option<Direction> {
        let a = a.edges();
        let b = b.edges();
        if a.0 == b.2 {
            // North edge of A matches bot of B
            Some(Direction::North)
        } else if a.1 == b.3 {
            // East edge of A matches West of B
            Some(Direction::East)
        } else if a.2 == b.0 {
            // South edge of A matches North of B
            Some(Direction::South)
        } else if a.3 == b.1 {
            // West edge of A matches East of B
            Some(Direction::West)
        } else {
            None
        }
    }

    fn strides(&self, width: usize, height: usize) -> Strides<char> {
        Strides::new(&self.grid, width, height)
    }
}

impl std::fmt::Display for Tile {
    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
        let gridstr = self
            .grid
            .iter()
            .map(|row| row.iter().collect::<String>())
            .collect::<Vec<String>>()
            .join("\n");
        write!(f, "{}", gridstr)
    }
}

#[allow(dead_code)]
const INPUT: &str = "Tile 3557:
.#...##.#.
#.#..#...#
##....#..#
.#...##..#
..###....#
..##..#...
#.#...##.#
..##..##..
.#.....##.
#.###.....

Tile 2203:
....#.#..#
##........
#.#...#...
#.#.##.###
.#....#..#
..#.#....#
#.....#...
#.#.#.....
.#...##.#.
##....##.#

Tile 3251:
...#.#.###
##.#...#.#
.#..##...#
....##...#
.#.......#
..#......#
#..#......
##.#.#.#..
#......#..
##.##.#...

Tile 3917:
.#.#...#.#
..........
#.#.#.####
#...#...#.
..#.##..#.
#.#.#.####
..#....#..
###.#....#
...##..#..
##.#####.#

Tile 2663:
.####.###.
....##..#.
......#..#
...#......
#.#.#..#.#
##.##.....
###.###...
..#..#....
##..##....
.#..##.#..

Tile 1093:
###.##...#
#....#....
#...#..#..
..##.#####
#.....##..
#....#.#..
#..#..#.##
#.#......#
...#.....#
#.##..###.

Tile 1279:
..###.##..
#.....#...
##..#....#
#...####.#
....###..#
#....#..##
..##...###
.##.#.....
##......#.
...##.#..#

Tile 3881:
##...#....
#..##.#..#
...###...#
....#...#.
###..#.###
..#...#..#
......#...
..#..#.#..
...##.##.#
#.#.#...#.

Tile 3793:
##...#.##.
...#..#..#
..#...##..
..###..#..
##......##
##......##
#..###.#.#
#.....#..#
.#.#..#..#
.#.##.###.

Tile 3919:
#####..###
##....###.
.####.#.##
#..#......
..#.#...##
.##..#...#
.....#...#
..#.....#.
...#......
.##.##.#.#

Tile 3769:
.#.####..#
......#..#
#......#.#
.#....#..#
.........#
..........
#.......#.
.#.....#..
#...#....#
####.#.#.#

Tile 1747:
...#...#.#
..#..#.#.#
.....#...#
#.##......
#.......##
.#........
#####.....
#.#..#....
..#.......
...#....##

Tile 2711:
.##..#.#.#
#.##......
......##..
.###...#..
.#......#.
#.#....#..
......#.#.
#....#.#..
#...#.#..#
#......##.

Tile 2801:
###....##.
#..#...#.#
....##.#.#
..........
..........
........#.
#....#....
#........#
....#..#..
##.#.#.###

Tile 2287:
####.#..#.
#..#..#...
....###..#
..#.......
#....#...#
......#...
##.....#..
.#......#.
#...##....
.#.####...

Tile 1607:
##.#.#.#.#
....#....#
......##.#
........##
#..#....##
#........#
#.#..#....
...#..#...
#....#.##.
.#...##.#.

Tile 1069:
####...###
#..##..#..
.........#
#.###.....
.#.##.#..#
#.#..#....
#.##..#..#
#...#...#.
.....#....
..#..#.#.#

Tile 1721:
####..#.#.
#.......##
.#.##.....
..........
..#..#...#
##..#..#.#
.....##..#
.#..#..#.#
##.#..#...
.#.##.#...

Tile 3049:
...#.####.
##.##..##.
.#........
.#.....#.#
.##.......
#..#.#...#
.#....#..#
###....#..
##..#..#.#
..###.#..#

Tile 1871:
####.#.##.
.....##...
####...##.
.........#
###.....#.
#.#......#
#..#...#..
#........#
#.##...#..
#......###

Tile 1723:
.#..######
.###....##
.........#
.........#
.....#..#.
##.#....##
...#.#..#.
....#...##
...#..#..#
##..##...#

Tile 2237:
.#.##.#.##
.#.......#
#.......##
..#...#...
....#...#.
#...#..##.
...##.#...
#..#.#....
##...###.#
#.#....###

Tile 1549:
#..###.###
.#..##...#
....##.#.#
#..#.##.#.
......#..#
#.#..##...
#..#....#.
#.#......#
....###...
##....#..#

Tile 3119:
#.#...####
#....##..#
..#....##.
#..#....##
#..#...#..
#...#...#.
....#..#..
.##...#..#
..#.#...#.
##..#.#.##

Tile 2129:
##.#.....#
#....#....
#.........
..##..##.#
#.#####.##
##......#.
#....#...#
.......##.
....##....
#.....####

Tile 3499:
#.#.##..##
.....##..#
##...#.#.#
......##..
#....#....
##......##
..#.#.....
###.###.#.
#..#.##...
######.#..

Tile 1249:
.##.#...##
###..#...#
.......#.#
.#.#..#..#
#.#...#..#
#..#..#..#
.....#....
....#.#.#.
....#....#
....##.#.#

Tile 2789:
##.#....#.
#....#.##.
...#....#.
#........#
###.....##
#........#
##.....#.#
####..##.#
.###.#.###
##.###.###

Tile 1447:
##..#.##..
...#...###
......#..#
...#..#...
..#....##.
...#.#....
..........
#..##.#...
##...#..#.
##..#..##.

Tile 1031:
.##..###.#
...#.##.#.
#....#...#
.......###
#.#......#
#.....##..
#....##.##
#..#.....#
........#.
.#..##....

Tile 1949:
#....#....
.#.#......
.#..##....
...###.#.#
....#...#.
#..#.....#
.#....#..#
.#.......#
..#.......
##.#..####

Tile 3079:
.###.#.#.#
..........
##......#.
.......###
#......#.#
#..#......
.##.......
..#.......
...##.....
#..#..#.##

Tile 2803:
.##.....#.
.#.....###
#...#....#
..#..#....
.......#.#
#......#.#
.#.##.####
..##....#.
#.#.#..#..
####.....#

Tile 1481:
..###.##.#
.#.#.#...#
##........
..#......#
.###.#.###
...##....#
.##.#....#
###...##..
.#.#.....#
##.###.##.

Tile 2003:
.###...##.
..#...##..
..#......#
###.......
#.##...#..
#..####...
##...#..#.
.....#...#
#......#..
..###.#.##

Tile 3697:
#...#...##
##...#....
.#...##...
.........#
#.#.#.#.#.
#.#......#
#..#.#..#.
#...#.#...
#...#.....
#..#.#..#.

Tile 3727:
##.#######
.#...#...#
.#...##..#
..##.....#
#..#....##
.........#
##.#...#..
##.#.....#
..#.......
..####..##

Tile 2699:
#.#..#.##.
##..#..#.#
####...#..
.......#..
#.#.....##
.#.......#
.....#.#.#
#..#.#....
.....#..#.
.....#..##

Tile 2011:
##..#.##.#
...#....##
#........#
..#.#.#.#.
.....#...#
#......##.
#.##..##.#
..##...##.
#.#.....#.
.#...###..

Tile 2777:
...####..#
#.##....#.
..........
##...###..
#.##....#.
.#.#.....#
..#..#.#.#
##...#..##
#.....#..#
#....#..#.

Tile 1787:
#.##....#.
##...#.#.#
#......#..
......##..
#....##..#
.....#....
....##....
#.#..#.##.
##....#..#
#.#.###.#.

Tile 1783:
#.#...#.#.
#..#.#...#
#..##..###
#..#.##...
.#....#...
##..##...#
#..#.....#
#.......##
#.#.....##
##..#.#..#

Tile 1423:
#.###.#..#
..#..##...
####..#.#.
#..##..#.#
.........#
##....#.##
#.##..#...
.........#
...##....#
#..#.###..

Tile 2917:
###...####
#....##..#
......#.#.
....#.##.#
....#....#
#........#
.#.....#..
...#.##..#
#...#.#..#
##...#..#.

Tile 1531:
#..#..#.##
...##.##.#
.......#.#
......#..#
....#....#
.#........
....#..#.#
...#....##
.#.#.##...
..##...#.#

Tile 1867:
#.#.#####.
.##...#..#
..........
#.##..#..#
#.###..#.#
.......#..
...#.#.###
...##.##..
.......#..
.##..###.#

Tile 1901:
##....####
.....##..#
#.#...#.##
.#.#..##..
...#...#.#
#..#...#.#
...##.#..#
#........#
...###...#
#####..#.#

Tile 2879:
.####.#..#
#.#.#..#.#
.##...#..#
####.##..#
..##.##...
##.......#
..........
#.#..##.#.
.#.#...#.#
.#..#.#.##

Tile 1187:
.#####.###
##.......#
.#...##.#.
.#..#.#.#.
.#..#..#.#
##....#...
#..#......
.##....###
.#.#...#.#
.#......##

Tile 1657:
..##.#..##
.#...###.#
....#.#..#
...#..#..#
..#......#
..#...#..#
...#...#.#
#.....#.#.
#..##..###
###.#.#..#

Tile 3533:
#####..#..
..#.#.##.#
.#........
........#.
.#...#.#..
.#........
.##.......
#......#..
#......###
.###.#.#.#

Tile 3037:
.#...#..##
#.#....#..
.....##...
#....####.
#..###.##.
#.......##
#..#..#...
#....###.#
#.....##.#
..#.###.##

Tile 2729:
.#.##.....
##...#..##
.#..#...#.
.#...#..#.
#.#...#...
###.#.#..#
#.........
.##...#.#.
##.......#
###..#.##.

Tile 3823:
...#...###
#..##.##..
...#......
...#....#.
....#....#
...#......
....#...##
#........#
...#....#.
#..#.#.#..

Tile 2081:
#..##..#..
...#....##
..........
#..#.#...#
#.#....#.#
#..#..#.#.
#####.#..#
....###.##
...#.#...#
.##..#.#..

Tile 1759:
#.#.#..#..
#........#
##........
#.#......#
.......#..
.#.#....##
....#.....
#......#..
#..##.#..#
..###...##

Tile 3467:
.#.####..#
#....###.#
...#..#...
#....#....
....##..##
#.#.......
#....#...#
.##...#.##
...#..#..#
##....#..#

Tile 3041:
...###.#..
.##.####..
.#.##..##.
#...##....
###......#
#...#....#
#..#.#.###
##.##.#..#
##.#.#...#
#..###..#.

Tile 2473:
###..#.#.#
#.##.##.##
#..#..#..#
##.......#
.#..#..#..
..##......
#.#...#...
...#.....#
.#....##..
#..##.#.##

Tile 3191:
.....#..##
##..#....#
#........#
.......##.
..#.#...##
...#.....#
.........#
..#.#.#...
##.#....##
#.#..#####

Tile 2269:
##..#.###.
#..#.#...#
#.....#..#
.#........
#.##..##.#
.....##.##
.......#.#
.#.......#
##.#..#.#.
.#.#.##.#.

Tile 1847:
...#...#.#
##.......#
#.......##
##........
##.......#
#..#..#...
...#....##
#.#.##...#
#.###....#
..##.####.

Tile 2399:
###....#.#
....#....#
....##..##
####.#...#
#........#
.....#...#
#..##.####
.#..#.....
##...#.#..
#.......##

Tile 1051:
.#..#....#
.......#..
.#...####.
#..#..#.##
##.....#..
##.#.#.#..
.#........
#..##..#.#
#...#.#.#.
##.#....##

Tile 3709:
#.....###.
#..#.#....
##..#..#.#
.......#.#
.....#..#.
.#..##.#.#
.###.##..#
#.##.#..##
..#......#
......##.#

Tile 1019:
##...##...
....#.....
.....#..#.
..........
##........
.........#
..........
#.#..#..#.
##....###.
#.####.#.#

Tile 1163:
...##...##
..#......#
......##..
..##..#...
#...#....#
#...#.##.#
....##....
#........#
#.......#.
##..####.#

Tile 1061:
###.#..#.#
.##.......
#.##..#...
.#..##..##
#...#.....
#......#.#
#..#.#...#
...#.#####
#...##.#.#
####.#.#..

Tile 1811:
....#..##.
.##.#....#
#.#.#..#..
###.....##
#.#......#
#...#.....
#...#.###.
#...#.....
..##......
##.#.####.

Tile 1301:
##.##.#..#
#.##.##...
#...#..##.
...#...#..
.#.#......
....#....#
....#....#
...#.....#
#.#.#.###.
#..#..####

Tile 1933:
.##.#.##.#
#...#.....
#.....###.
..##....#.
###...#...
##..#....#
#.....#..#
#......###
#.....#.##
.##.###.#.

Tile 1889:
##.#.##...
....#.....
..........
..##.##...
....##...#
#.#.#....#
...##.#...
.##.....#.
....##...#
..########

Tile 2411:
#...#.#..#
......#..#
#...#..#..
..#.....#.
#.#..#...#
..#......#
#...#.#...
.......#..
..........
..##..#.##

Tile 1861:
.##...#.##
.....##...
#........#
..#..#....
##.....#.#
.#####...#
.#.##..#.#
##..#....#
#.......#.
##..#..#..

Tile 2671:
..#..#....
##..#....#
#.#.......
.#.#.....#
...#......
..#......#
##........
###.....##
##.##.#.#.
..#.##..#.

Tile 2347:
#.####....
#.....#...
#...#.####
.###..#..#
#.#.#.....
#.#.......
........#.
..##..#...
#..###....
#..#...#..

Tile 1913:
#..#.#..##
#.#.#.#.#.
....#.#.#.
#.....#..#
#.#.###...
#.#..#.#..
.#.....#..
.##...#..#
#.......##
..#.#.##..

Tile 2887:
#####..###
....##...#
#......#..
###.#.###.
#........#
....#.....
####..###.
....#....#
....#.#...
.###..####

Tile 3449:
..###.#...
##.#.##..#
...#......
#..#......
..#.#...#.
#...#...#.
#.......##
.........#
...#.#...#
#.##.##..#

Tile 3947:
.......###
.#.#.....#
#.#.#..##.
..#...#.#.
#..#...###
....#..###
......#...
#..##.###.
..#...#..#
..##.#.##.

Tile 1109:
#.##..#.##
.#.......#
#.....##.#
.........#
#.#..#...#
#...#....#
#.........
#.#......#
.....#.#.#
.#.#####.#

Tile 1153:
#.#.###..#
####....##
......#...
........##
........#.
##..#....#
....#.#..#
#.#....#..
.#.#....##
.#....#.##

Tile 3259:
.#.#...###
##....##..
#...####..
.#...#...#
..#.#.#..#
#....###..
...#.###..
.....#.##.
#...#..#.#
.###...#.#

Tile 3659:
##.#..#.#.
#.......##
#.....##.#
.#..#.....
#...##.#.#
#.##...#..
.##.#..#..
.##.#..#.#
#.##..#.#.
#..#######

Tile 3833:
##.##....#
.###.....#
##.......#
##.#.##..#
..##....#.
##.......#
#....#....
#.#......#
.###.#.#..
..#..#....

Tile 3529:
##..#####.
#..#....##
...#.....#
#..##....#
.#.#.###.#
#.##......
.#.#...#..
#...##..##
.......#.#
..#.#.##.#

Tile 2819:
#.#..###.#
.......#.#
#...#..##.
##.#.....#
.#..#.....
.#..#.####
#.......##
.#...#....
####.....#
##.....##.

Tile 1801:
#####..##.
####..###.
#.#..#..#.
..#......#
...#....#.
#.#......#
...#.##..#
#...#.....
##....##..
.#.#..###.

Tile 1307:
######.##.
..#......#
.......##.
#.#....#..
#.#.#..#..
.........#
....##.#..
..##..##..
#....#...#
#...##.#.#

Tile 2719:
..#######.
#......#..
###....##.
#.....#.##
#..#..#.#.
....#....#
......##..
##.#...#.#
#.....#.##
#..##.##..

Tile 1973:
####..##.#
......#...
##.....##.
#..#..#...
......#...
.......#..
....#.#..#
##.#..###.
#.##...#.#
##.###.#.#

Tile 1553:
#....#..##
...#......
#........#
#..#.....#
..#.......
#..#.#.#..
.......#..
.#.#...#..
##.#.....#
.###..#.#.

Tile 3271:
.#..#..#.#
#.#...#.##
#......#.#
###......#
#....#....
##.......#
#..#.##..#
#.......#.
...#.#....
.###.#####

Tile 3797:
#.##..####
.....#....
#...#...#.
#...##....
#....#..#.
#...##.##.
##...##.#.
#.......#.
#.##...#.#
#...##.#..

Tile 2089:
##..###..#
##...#..#.
#....##..#
..##.....#
.......#.#
#.....#..#
#....#....
.....#.##.
..##..#.##
.....##..#

Tile 3821:
.###.....#
..#.#..##.
.#...#....
.........#
#...#.....
#....##..#
#...#....#
#...#...#.
..#..#....
##.####...

Tile 2549:
...###.#..
..#.##..#.
#.#.......
..##......
#.#......#
..#...#..#
.#..#.##..
..#....#..
#...##..#.
##..#..#.#

Tile 1697:
.##.#.##..
.......#..
.#....####
#......#.#
.......#..
...#..#..#
#......#.#
.#.....###
#..#...#..
#...###...

Tile 2749:
..#...#..#
..#...#..#
#.##.###..
..##......
#..#.###..
#.####....
#.....#...
#.#.#.....
#.........
#...###.##

Tile 1063:
.##..#..#.
..#....#.#
..##..#..#
........#.
...#.....#
.........#
#.....#.##
.......###
##..#.#...
.#..####..

Tile 1471:
...##..#.#
##.#..#...
#...#....#
..#......#
#.#.#...##
..##.....#
.........#
......##.#
.#..#.#..#
#...#####.

Tile 1609:
#..##.####
##...#....
#.#...#...
.#.###.###
.....#.#..
##....#...
...##...#.
##........
#...#.#...
##...#....

Tile 2437:
..##.#.#.#
..#.#....#
...#......
#.....#..#
.#....#..#
##..##....
#.#......#
.....#..#.
....##.###
..#####.##

Tile 1823:
###..###..
##...#....
#.....###.
#........#
.....###.#
.....#..##
#..#..#...
##........
#.........
..########

Tile 2273:
#.#.#.#.##
....#..#..
#..#......
#....##...
.#.#..#.##
#.........
.#.##..#..
..#......#
#....##.#.
##.##.####

Tile 3607:
##.#.###.#
...#.....#
##..##..##
...###....
..##.#...#
#.#...#.#.
#...#....#
#..####...
....#.#.#.
...#...###

Tile 1303:
.#..######
...#...#.#
..##...##.
....#..#..
#.#.###.##
##.#..####
..#...#...
#.#.#..#.#
#.........
#.#.#####.

Tile 1283:
.#.#.#....
.#..##....
.#...#....
#.........
##.###...#
##.####..#
#....#...#
.#.#...#.#
#.##.....#
##.#..#.#.

Tile 2791:
#....###..
....#....#
#......#.#
#....#.##.
.#.##....#
#......#.#
.......#..
....#....#
#..#......
..#####.##

Tile 2797:
.#####..#.
.......#..
#..##....#
.##...##.#
.#...#.#.#
#.#...##.#
#.#.......
##.##...##
..#....#..
###..##...

Tile 1087:
......#.##
#.#......#
.#....#..#
#.#.#.#..#
#...#.....
#..#...#..
.....#...#
...#......
#.....#..#
###..##.##

Tile 1409:
#####.###.
.#.#.#...#
#....#...#
.....#.#.#
#....#..##
###..##.##
##..####..
..........
#........#
.####.#.##

Tile 3593:
#.######..
##...#.#..
..#......#
#.....##.#
.#...#....
#...#.#.#.
...#..#...
##.......#
.....#...#
...#..#..#

Tile 3347:
.#.##.#.#.
..........
....#...#.
#.#..#..##
...#..##..
##.#....#.
#.#..#...#
.#.###.#.#
#...#.#..#
.#.####.##

Tile 3637:
.#.##....#
##...###.#
.#.#.#....
....##...#
.#........
#......#..
##.#...#..
###..##..#
.#........
...#.###..

Tile 1907:
#.#.#..###
.##..#....
##..#..#.#
.......#..
#..#......
..##.#..#.
.###..##.#
.......#.#
.#....#...
#..#...#.#

Tile 3371:
#.##...###
.....#....
#......#..
.#.#..#...
##.#...#..
.##......#
..#..###.#
#.....#.#.
#.#..#.#.#
...#..####

Tile 1367:
##.....#..
.#..#..#..
.###....##
.#.#..#.##
##.....##.
###.....##
...#...#.#
#....#...#
##.....#.#
#....#.##.

Tile 1559:
#..#.##..#
#..#.##...
#.#..#...#
.......#.#
....#.####
#...#...##
..#.#...##
#....#...#
..#..#.#.#
.........#

Tile 2713:
..#.###.##
#.##.....#
#......#.#
#..#...#..
.#.......#
.......##.
.........#
..#...##.#
#....#.#.#
#.#..##...

Tile 3203:
###.#####.
###...#...
###..#...#
.#..##..##
#....#.##.
#.....#..#
#....#...#
..........
.##...#...
.#.###.##.

Tile 1979:
#...#.#..#
#.#.....#.
.#.###...#
.....#.##.
##.#.#..##
.##....###
.##......#
#......#.#
#.....#.#.
......##.#

Tile 3307:
..##...#.#
#......#..
##..#.##..
...##.#.##
.##.......
.##....###
#..##.#..#
.#.#.#....
#...#.#..#
#.#..###.#

Tile 1667:
###.#.##..
.......##.
..#...##..
........##
#.......##
#.....##..
...##.#.#.
#.......#.
........##
##....#...

Tile 1699:
..##...###
.....#....
#..#.###..
...##.....
.##.#..#..
......#...
#.........
####.....#
#.#..#....
#...#..#.#

Tile 2591:
#...##....
###..###..
##.#..#...
..#.#..##.
.....#.#.#
##..###...
#..####.##
##........
..#......#
.###.#..#.

Tile 3169:
####.##...
##.##.....
......#...
#.##..#.##
....###.#.
#.#..#..##
#..###....
#..#.....#
..###..#..
##..##..#.

Tile 1459:
..#...####
.....##...
..#.......
...#.#....
##....#..#
.##...##.#
..#..#.###
#.##..#...
#..#.#.#.#
..#.#.##..

Tile 3373:
..#####..#
..#..#...#
#.###..#.#
...##.....
.#.##.....
#..#..#...
....#.....
#.#.#....#
...#...#..
.##.......

Tile 3461:
######...#
....##....
##........
#.#..#.#.#
###.....#.
.....#....
.....###.#
##.......#
....###.#.
..#.#..##.

Tile 2609:
#####...##
#.........
.....##...
##....##..
..##.#....
##.......#
........#.
........##
####......
.#.###....

Tile 2459:
#..##.#...
.#...#####
##........
#....#....
#...##.#..
##...###.#
##........
...##....#
#...#....#
.##.....#.

Tile 1831:
###..#..##
.#......##
.#.#..#...
#......#.#
#.........
..#....#..
.####...#.
....#..#..
......##.#
###...#..#

Tile 2063:
.###...#.#
###......#
##..#..###
##........
.###.##.##
##.#.#..#.
..##....##
..#......#
#####...#.
#####..#..

Tile 2281:
#...####..
..#.#....#
........#.
#.........
..#..#..##
##.##..#.#
........#.
....##...#
####.#.#.#
.###..#..#

Tile 1583:
#####.##.#
#....##.#.
#..##.....
...#......
..###.#...
..##.....#
##..#....#
.....#...#
.......##.
#.##...#.#

Tile 2539:
..##......
.#..#..#..
#...#...#.
#..##.#.#.
......####
#.##...##.
##...#..#.
#.#......#
##....#..#
###..#...#

Tile 2909:
..#.....##
##...##..#
#........#
.#........
###....###
...#.##..#
#..#..##..
#..##...#.
....#....#
#..##..#..

Tile 2939:
..#...#.#.
..#.......
..........
.#.##..#.#
#.##.##.#.
###.#....#
..#..#....
.##......#
##...##...
##.#..#...

Tile 3889:
##..#.#.##
##.####...
#.#.####..
..####..#.
##.#.....#
#.......##
........##
##.##....#
...###...#
#..###..##

Tile 1427:
#.#.#....#
##.##.####
.....#...#
#.#..#....
...#.#..#.
.....#...#
.#...###.#
####.#....
........##
#..#..##..

Tile 1319:
.#####...#
#...#....#
#........#
#....##...
.##......#
..#.....##
.....#..##
......#..#
...#....#.
.##....###

Tile 1523:
.....###.#
..#......#
...#.....#
#..#..#..#
.........#
#..#..#.#.
####..#..#
..#......#
...##.##.#
####....##

Tile 2381:
.#.#..##.#
#..#..#.##
..........
..###..#..
.###.##.##
##....##.#
...##....#
#...#.....
.#.......#
#....###..";

#[allow(dead_code)]
const SAMPLE: &str = r#"Tile 2311:
..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###

Tile 1951:
#.##...##.
#.####...#
.....#..##
#...######
.##.#....#
.###.#####
###.##.##.
.###....#.
..#.#..#.#
#...##.#..

Tile 1171:
####...##.
#..##.#..#
##.#..#.#.
.###.####.
..###.####
.##....##.
.#...####.
#.##.####.
####..#...
.....##...

Tile 1427:
###.##.#..
.#..#.##..
.#.##.#..#
#.#.#.##.#
....#...##
...##..##.
...#.#####
.#.####.#.
..#..###.#
..##.#..#.

Tile 1489:
##.#.#....
..##...#..
.##..##...
..#...#...
#####...#.
#..#.#.#.#
...#.#.#..
##.#...##.
..##.##.##
###.##.#..

Tile 2473:
#....####.
#..#.##...
#.##..#...
######.#.#
.#...#.#.#
.#########
.###.#..#.
########.#
##...##.#.
..###.#.#.

Tile 2971:
..#.#....#
#...###...
#.#.###...
##.##..#..
.#####..##
.#..####.#
#..#.#..#.
..####.###
..#.#.###.
...#.#.#.#

Tile 2729:
...#.#.#.#
####.#....
..#.#.....
....#..#.#
.##..##.#.
.#.####...
####.#.#..
##.####...
##..#.##..
#.##...##.

Tile 3079:
#.#.#####.
.#..######
..#.......
######....
####.#..#.
.#...#.##.
#.#####.##
..#.###...
..#.......
..#.###..."#;

#[allow(dead_code)]
const SAMPLE2: &str = r"Tile 1:
1abc
.,:;
wxyz
.,:;
";
